{% extends "base.html" %}

{% block content %}
  <h1>Running scans</h1>
  {% if running_scans %}
  {% for scan in running_scans %}
    <div class="card border-success text-center m-2" style="width: auto;">
      <div class="card-header">Running scan...</div>
      <div class="card-body">
        <h5 class="card-title">Scan Title: {{ scan.scan_title }}</h5>
        <p class="card-text"><b>
          {% if scan.scan_type == 'T4' %}
            Aggressive scan
          {% elif scan.scan_type == 'T2' %}
            Normal scan
          {% else %}
            Cautious scan
          {% endif %}
          </b>
          is running on <b>{{ scan.targets }}</b> on port(s) <b>{{ scan.ports }}</b>.
        </p>
        <div class="card-footer text-body-secondary">
          <p class="card-text"><i>Started at {{ scan.start_date }}</i></p>
        </div>
      </div>
    </div>
  {% endfor %}
  {% else %}
    <div class="card border-light text-center" style="width: auto;">
      <div class="card-body">
        <p class="card-text"><i>No scans are currently running.</i></p>
        <a href="{% url 'new_scan' %}" class="btn btn-success">New Scan</a>
      </div>
    </div>
  {% endif %}

  <hr>

  <h1>Previous scans</h1>
  {% if completed_scans %}
  {% for scan in completed_scans %}
    {% if scan.result_json.highest_severity == 0 %}
    <div class="card text-bg-success m-2" style="max-width: auto;">
      <div class="card-header bg-transparent">No vulnerabilities found</div>
    {% elif scan.result_json.highest_severity == 1 %}
    <div class="card text-bg-light m-2" style="max-width: auto;">
      <div class="card-header bg-transparent">Highest severity found: <b>INFO</b></div>
    {% elif scan.result_json.highest_severity == 2 %}
    <div class="card text-bg-info m-2" style="max-width: auto;">
      <div class="card-header bg-transparent">Highest severity found: <b>LOW</b></div>
    {% elif scan.result_json.highest_severity == 3 %}
    <div class="card text-bg-warning m-2" style="max-width: auto;">
      <div class="card-header bg-transparent">Highest severity found: <b>MEDIUM</b></div>
    {% elif scan.result_json.highest_severity == 4 %}
    <div class="card text-bg-danger m-2" style="max-width: auto;">
      <div class="card-header bg-transparent">Highest severity found: <b>HIGH</b></div>
    {% elif scan.result_json.highest_severity == 5 %}
    <div class="card m-2" style="max-width: auto;background-color: purple">
      <div class="card-header bg-transparent">Highest severity found: <b>CRITICAL</b></div>
    {% endif %}
      <div class="card-body">
        <h5 class="card-title">Scan Title: {{ scan.scan_title }}</h5>
        <p class="card-text"><b>
          {% if scan.scan_type == 'T4' %}
            Aggressive scan
          {% elif scan.scan_type == 'T2' %}
            Normal scan
          {% else %}
            Cautious scan
          {% endif %}
          </b>
          ran <b>{{ scan.targets }}</b> on port(s) <b>{{ scan.ports }}</b>.
        </p>
        <p class="card-text"><i>Duration: {{ scan.run_time }}</i></p>
        <a href="{% url 'scan_details' scan_id=scan.id %}" class="btn btn-dark bg-dark">View Details</a>
        <a href="{% url 'update_title' scan_id=scan.id %}" class="btn btn-dark bg-dark">Edit Title</a>
        <button type="button" class="btn btn-danger btn-outline-dark" data-bs-toggle="modal" data-bs-target="#delete-{{ scan.id }}">
          Delete Scan
        </button>
        <div class="modal fade" id="delete-{{ scan.id }}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Delete <code>{{ scan.scan_title }}</code>?</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <a href="{% url 'delete_scan' scan_id=scan.id %}" class="btn btn-danger">Delete</a>
              </div>
            </div>
          </div>
        </div>
        <a href="{% url 'rerun_scan' scan_id=scan.id %}" class="btn btn-primary" style="float: right;">Rerun Scan</a>
      </div>
      <div class="card-footer text-body-secondary">
        <i>
        <p class="card-text">Finished at {{ scan.finish_date }}</p>
        </i>
      </div>
    </div>
  {% endfor %}
  {% else %}
    <div class="card border-light text-center" style="width: auto;">
      <div class="card-body">
        <p class="card-text"><i>Empty</i></p>
      </div>
    </div>
  {% endif %}
{% endblock %}